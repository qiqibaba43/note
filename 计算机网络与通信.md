[TOC]


# 1.概论

## 1.主要发展阶段

- 面向终端的计算机网络
- 多个计算机互联的计算机网络
- 面向标准化的计算机网络
- 面向全球互联的计算机网络

## 2.计算机网络的定义

把分布在不同地点且**具有独立功能**的多个计算机，通过**通信设备与通信路线**连接起来，在**功能完善的网络软件**运行环境下，以实现**资源共享**为目标的系统

从逻辑上可分为：

- 通信子网：网络信息的传输与交换
- 终端系统：负责信息的处理

从图论上可分为：

- 边缘节点：构成终端系统
- 中间节点：构成通信子网

## 3.计算机网络的类型与特征

- 根据拓扑结构分类
  - 星型网
  - 树型网
  - 总线型网
  - 环型网
  - 网状网
- 根据网络覆盖的范围分类
  - 个人局域网
  - 局域网
  - 城域网
  - 广域网
- 根据通信传输媒介分类
  - 有限网
  - 无线网

## 4.通信协议与网络体系结构

协议发展的历史：

`ARPANET->SNA->ISO/OSI-RM`

协议是通信双方必须遵循的，控制信息交换的**规则的集合**。规定有关功能部件在通信过程中的操作，定义了数据发送和接受工作中必经的过程。协议规定了网络中使用的格式，定时方式，顺序和检错

网络体系结构的定义：

网络体系结构是计算机网络的分层，功能以及协议的集合

网络协议的三要素：

- 语法：数据与控制信息的结构或格式，确定通信时采用的数据结构，编码及信号电平等等
- 语义：对构成协议的协议元素含义的解释
- 同步：规定了事件的执行顺序

网络协议的特点：

- 层次性，可靠性和有效性
- 网络协议的分层将复杂问题简单化

协议层次模型：

- 实体：通信时能发送和接受信息的任何软件，硬件设施
- 层：功能相近或相关的实体的集合
- 协议：网络分层结构中各***对等层***之间的通信规则
- 接口：网络分层结构中各***相邻层***之间的通信接口

协议分层的优缺点：

- 各层之间是独立的，灵活性号
- 已于分别实现和维护，便于升级
- 通过规范的接口进行交互
- 能促进标准化工作
- 可能导致系统实现效率降低

协议模型：

![](https://gitee.com/qiqibaba43/image/raw/master/协议模型.png)

## 5.OSI/RM体系结构

1. 物理层：利用传输介质为通信的网络节点之间建立，维护和释放物理连接
2. 数据链路层：在通信实体间建立数据链路连接，传输以帧为单位的数据包
3. 网络层：为分组交换网络上的不同主机提供通信服务。为分组为单位的数据包通过通信子网选择适当的路由
4. 传输层：向用户提供端到端的数据传输服务
5. 会话层：维护通信中两个节点之间的会话连接的建立，维护和断开，以及数据的交互
6. 表示层：处理在两个通信系统中交换信息的表示方式中交换信息的表示方式
7. 应用层：为应用程序通过网络服务，包含了各种用户使用的协议

![](https://gitee.com/qiqibaba43/image/raw/master/OSI模型.png)

## 6.TCP/IP协议簇

- 应用层：向应用进程提供各种应用服务
- 传输层：向应用层提供面向连接的可靠的（使用TCP）或不可靠无连接的（使用UDP）传输服务
- 网际层：使用IP向传输层提供无连接分组交付服务
- 网络接口层：实现与具体网络的连接

![](https://gitee.com/qiqibaba43/image/raw/master/TCP协议.png)

# 2.数据通信技术基础

## 1.信息，数据和信号

![](https://gitee.com/qiqibaba43/image/raw/master/信息，数据和信号.png)

- 信源：信息的发送端
- 信宿：信息的接受端
- 信息转换设备：将信源发出的信息转成适合于信道上传输的信号的设备
- 信道：信号的传输通道

## 2.传输媒体

- 有线传输媒体

  双绞线，同轴电缆，光缆

- 无线传输媒体：

  - 传统无线电：长波，中波，短波

  地面微波，卫星微波

  红外线技术，蓝牙，WiFi

****

一般无线电波是全向传播，而微波是定向传播

****

## 3.数据通信系统的技术指标

### 1.数据传输速率

- 传码速率：指在数据通信系统中，每秒钟传输信号码元的个数，记作$N_{Bd}$，单位波特（Baud）

- 传信速率：指在数据通信系统中，每秒钟传输二进制数据的个数，记作$R_{b}$,单位比特每秒

- 传码速率：每秒钟传输信号码元的个数，不考虑信号的状态数

- 传信速率：每秒钟传输二进制数据的个数，表示信息量

  $R_{b}=N_{Bd}log_{2}M$            M:信号状态

****

每个信号码元需要用几个比特来表示，所以运送一个信号码元，相当于运送了几个比特。比如一个信号码元用八个电平组合表示，就需要$log_28$个比特来表示

****

### 2.信道带宽

带宽：某个信号具有的频带宽度。单位Hz

- 模拟信号带宽：表示通信线路允许通过的信号***频带范围***
- 数字信号带宽：信道素能传送的最高数据率，单位“比特/秒”

### 3.误码率和误组率

- 误码率：

  在一定时间（至少十五分钟）内接收到出错的比特数$e_{1}$与总的传输比特数$e_{2}$之比

  $\textcolor{green}{P_{e}=e_{1}/e_{2}*100%}$

- 误组率

### 4.时延

1. 发送时延：发送数据时使数据块从节点进入刀传输媒介所需要的时间。

   $\textcolor{green}{发送时延=数据块长度/信道带块}$

2. 传播时延：电磁波在信道中传播花费的时间

   $\textcolor{green}{传播时延=信道长度/传播速度}$

3. 处理时延：数据在交换节点位存储转发花费的时间。往往取决于***当时的通信量***

## 4.数据的传输方式

### 1.并行传输

数据以成组的方式，在多条并行信道上同时进行传输

优点：不需要同步

缺点：线路多，成本高，不适合远距离传送

### 2.串行传输

组成字符的若干位二进制码排列成数据流在一条信道上逐位顺序传输

缺点：需要收发双方码组的同步

## 5.异步传输与同步传输

### 1.异步传输

发送代码时，都要在前面加上一个起始位，长度位一个码元长度，极性位“0”，表示一个字符的开始；后面加一个停止位，长度可选为1，1.5或2的码元长度，极性为“1”，表示一个字符的结束

![](https://gitee.com/qiqibaba43/image/raw/master/异步传输.png)

优点：实现字符同步比较简单，双方的时钟不需要严格同步

缺点：不适合高速率的数据通信，输出效率低

### 2.同步传输

以***固定的时钟节拍***来发送数据信号。所以各个信号码元之间的相对位置是固定的。为了从收到的数据流中正确的区分出一个个信号码元，必须***具有与发送端一致的时钟信号***。发送的数据一般以***帧***为单位。在一帧数据的前后分别加上若干同步字符和校验位，传输结束字符来表示这一帧的开始与结束

![](https://gitee.com/qiqibaba43/image/raw/master/同步传输.png)

具有较高的传输速率

****

- 单工传输：数据的传输只能沿单一方向发送和接受
- 半双工传输：数据可以在两个方向上传输，但***双方不能同时通信***
- 全双工传输：数据可以在两个方向上同时传输

****

## 6.模拟传输和数字传输

### 1.模拟传输

时间和幅度取值练习变化的信号量

### 2.数字传输

时间和幅度取值离散的信号量

## 7.数据序列的电信号表示

### 1.单极性码和双极性码

二进制数字的表示方式是用正电平表示“1”，0电平表示“0”，就成单极性码；若正电平表示“1”，负电平表示“0”，就称为双极性码

### 2.不归零码和归零码

在一个码元周期中，数据电信号的电平值保持不变，就是不归零码。在一个周期中，电平维持某个值一段时间就返回零，就称归零码。零电平占整个码元周期的比例为占空比，通常为50%

### 3.差分编码

又称相对码。用前后码元的电平是否有变化表示传输是“0”还是“1”。有变化表示“1”，没有变化表示“0”

### 4.伪三进制码

用零电平表示“0”，正负电平交替表示“1”

### 5.曼彻斯特编码

每个码元周期的中间都有跳变，“0”表示负电平到正电平；“1”表示正电平到负电平

### 6.差分曼彻斯特编码

先转化为差分码，再转化为曼彻斯特码

## 8.信道容量

给定条件，通信路径上的数据传输速率

### 1.奈奎斯特定理

在理想的条件下，无噪声有限宽带为W的信道，最大的数据传输速率C

$\textcolor{green}{C=2Wlog_{2}M}$   其中M是电平的个数

### 2.仙农定理

有噪声的环境中，信道容量将于信噪功率比有关，在给定宽带W，信噪功率比S/N的信道，最大数据传输速率C

$\textcolor{green}{C=Wlog_{2}(1+S/N)}$

S/N常用分贝的形式表示

$\textcolor{green}{(S/N)dB=10log_{10}(信号功率P_{1}/噪声功率P_{2})}$

## 9.基带传输和频带传输

矩阵脉冲信号的固有频带称为基本频带

先将基带信号变换成便于在模拟信道上传输的，具有较高频率范围的信号，再将频带信号再信道中传输

常用的调制技术：

- 载波：一种百年与发射和接受，及技术实现的高频简谐波或周期脉冲信号

- 当个载波为高频简谐波时，可以通过控制：$\textcolor{red}{振幅，频率，相位}$的变化，实现调制功能

### 1.数字调幅

简称ASK，以数字数据控制载波幅度。又称幅移键控

### 2.数字调相

简称PSK，以数字数据控制载波相位。又称相移键控

### 3.数字调频

简称FSK，以数字数据控制载波频率。又称频移键控

## 10.多路复用技术

在一条传输信道上传输多路信号，以提高传输媒体的利用率

### 1.频分复用

按频率划分不同的子信道，每个子信道占用不同的频率范围。

常用于载波电话系统，有限电视

![ADLS](https://gitee.com/qiqibaba43/image/raw/master/202303061932083.png)

### 2.时分复用

采用时间分片方式数显传输信道的多路复用。每一路信号传输都使用信道的全部宽带，但只能使用其中某个时隙

- 静态时分复用

  多个终端的信号在预定的时隙内传输，分配关系固定，周期使用。告诉传输介质容量等于各个低俗终端数据速率之和

- 动态时分复用

  又称异步时分复用（STDM），各个终端使用的时隙不确定，按需求分配媒体资源。数据传输速率之和可以大于告诉线路传输容量

### 3.码分复用

常用的有：CDMA

蜂窝移动通信中发展的一种信号处理方式，各个站点采用不同编码

- 每一个比特事件划分为m个短的间隔，称为码片。每个站被指派一个唯一的m bit码片序列

- 每个站分配的码片序列不仅必须不相同，并且还必须相互正交

- 使用的伪随机序列

### 4.波分复用

***就相当于光的频分复用***，即在一根光纤上传输多路光载波信号

- CWDM：稀疏波分复用，实现技术要求低。但复用路数少
- DWDM：密集波分复用，支持巨大数量信道的，但技术和设备要求高

## 11.信号交换技术

### 1.电路交换

过程：

- 呼叫建立
- 通话
- 连接释放

特点：

- 实时交换全程小于200ms
- 预分配宽带，利用效率仅为36%
- 没有差错控制

### 2.报文交换

中间节点

存储转发

完整报文

特点：

- 随机性打，转发时延大，过负荷时将会导致报文延迟

### 3.分组交换

将长报文划分若干段，称为分组，以分组为单位转发

特点：

- 可实现多路通信
- 采用动态时分复用，提高了利用率

##  12.差错控制技术

差错，就是在通信手机收到的数据和发送端发送的数据不一致的情况

差错产生的原因：

- 随机差错
- 突发差错

在发送的数据码元序列中加入$\textcolor{red}{监督位}$，并进行变换，使得监督位和原来相互独立，随机的数据位之间存在某种关系

- 检错码:发现传输错误，但不能自动修正
- 纠错码：自动纠正传输错误
- 提高传输可靠性，是以降低效率位代价

### 1.差错控制方式

- 自动请求重发
- 前向纠错
- 混合方式：少量差错予以纠正，过量通过重发加以纠正
- 信息反馈
- 判决法

检错码：

- 恒比码
- 正反码
- 奇偶校验码
- 循环冗余码

纠错码：

- 汉明码

线性码：信息位和监督位为线性关系

分组码：监督位仅与本位信息位有关

系统码：前半部为未变化的信息位，后半部为生成的监督位

### 2.差错控制编码

二进制编码中,<font color="red">消息长度k比特，冗余信息r比特，实际传输长度n比特，n=r+k</font>

$2^n$种组合，能表示信息的$2^k$种码组被称为$\textcolor{red}{许用码}$，其余的称为$\textcolor{red}{禁用码}$

- 码间距离：两个码字的对应位取值不同的个数
- 汉明距离：一个有效编码集中，任意两个码字的码间距离的最小值

#### 1.奇偶校验码

在数据码后附加一个校验位，使得构成的码组中“1”的个数为奇数（奇校验）或偶数（偶校验）

***汉明距离为2***

#### 2.汉明码

- 检测e个差错，编码集的汉明距离至少e+1
- 纠正t个差错，编码集的汉明距离至少2t+1
- 检测e个差错，并纠正t个差错，编码集的汉明举例至少e+t+1

![较正子与错码](https://gitee.com/qiqibaba43/image/raw/master/202303082005312.png)

#### 3.循环冗余码

简称CRC，是一种特殊的线性分组码

- 封闭性
- 循环性：将码组中的码元循环左移（或右移），形成的码组仍是一个许用码组

编码步骤：

1. 根据多项式写出编码
2. 将序列左移多项式的最高幂次数，右侧补0
3. 新生成的序列加上编码后发送
4. 接受到的序列除以编码，若余数为0，则无差错；否则就是有差错

## 13.数据通信接口特性

物理层是OSI参考模型中的最底一层，向下是与物理设备之间的接口，直接与传输介质相连接，使二进制数据位流通过接口从一台设备传送到相邻的另一台设备，$\textcolor{red}{向上为数据链路层提供透明的比特流传输服务}$

- 物理层接口不仅包括DTE-DCE之间的接口，应用中也包括DCE-DCE直接的接口
- 物理层不包括传输媒介本身的特性

接口特性标准：

- V系列：模拟传输系统（电话网）中实现数据通信
- X系列：专门为数据通信指定

通信接口特性值DTE和DCE之间连接的物理特性，与DCE类型，传输信道（数字/模拟），通信方式（半双工/全双工）和通信速率有关

物理层标准：

### 1.机械特性

知名接口所用的接线器的形状和尺寸，引线数目和排列，固定和锁定装置等等

### 2.电气特性

指明在接口电联的各条线上出现的电压的范围

信号一般用电流，电压表示，需要两条信号路线

- 不平衡电路：使用公共地线作为其中一个信号线，信号线与地线比较，容易引入底线干扰和电位差影响，速率较低
- 平衡电路：两个信号线差分驱动，接收方差分输入，有单独的地线。两个线路信号相对比较，与地线信号独立，抗干扰能力强，具有较高的信号速率

### 3.功能特性

指明某条线上出现的某一电平的电压白哦是何种意义

### 4.规程特性

指明对于不同功能的各种可能时间的出现顺序和条件

# 3.数据链路层

## 1.数据链路层基本概念

差错：

- 传输信道的不理想及外界干扰的存在，使得差错不可避免

- 数据比特流的独立星星和随机性，使得物理层无法发现可能存在的数据传输差错

- 收发双方还需要在逻辑上协调收发速率，保证数据不会丢失或接受溢出

<img src="https://gitee.com/qiqibaba43/image/raw/master/202303091339867.png" alt="数据电路与数据链路"  />

- 信道：信息传输的通路
- 数据电路：在传输信道两端加上信号变化设备滞后所形成的二进制比特流通路，又称为物理链路或链路
- 数据链路：在数据电路建立的基础上，在链路协控制下，使同信双方正确传输数据的终端设备与传输线路的组合体，又称逻辑链路

### 1.数据链路的结构

- 链路上所有连接的节点称为站
- 发送命令或信息的站称为主站，在通信过程中起控制作用；接受数据或命令，并作出响应的站称为从站，在通信过程中处于受控地位
- 同时具有主站和从站功能的，能够发出命令和响应的站称为复合站

基本结构：

- 点到点链路（平衡型，不平衡型）
- 多点链路（平衡型，不平衡型）

传送方式：

- 单工通信
- 半双工通信
- 全双工通信

### 2.数据链路层的功能

目标：在数据链路上提供相对可靠的信息传输

功能：

- 链路管理

  在传输数据时要维持数据链路，交换控制信息，在通信完毕后要释放数据链路

- 帧同步

  将比较长比特流分解成多端离散的段，独立发送，接受和处理。这些段在数据链路层就称为帧

  帧的结构：***传输的数据，响应的控制信息，校验信息，帧之间的分隔标志***

  帧的构成方法：

  - 字符计数法
  - 含字节填充的分界符法
  - 含位填充的分界标志法
  - 物理层编码违例法

- 流量控制
- 透明传输
- 差错控制
- 数据和控制信息
- 寻址

## 2.流量控制和差错控制

### 1.流量控制

在网状拓扑的各个网络节点之间的通信，数据分组采用存储——转发方式传输，某个节点可能同时收到来自多个方面大流量数传送，同时处理能力的差异，可能导致接受处理和存储能力不足。设置一定的缓冲区可以调节收发双方速率不匹配的情况

通信过程中，要求发送方的发送数据速率不能超过接收方接受和处理数据段速率

#### 1.开关式流量控制

“开”命令通知发送方发送数据。当接收方来不及处理信息，并且接受缓冲区被消耗殆尽，发送“关”命令

#### 2.协议式流量控制

发送方发出信息帧，接收方收到数据帧后，向发送方发送ACK确认收到，发送方收到后，继续发送下一个数据帧

1. 发送的数据帧被识别出错误

   不向发送方发送ACK，而是发送NAK。发送方收到否认帧NAK后，会将刚刚发送的数据帧再发送一遍

2. 发送的数据帧被丢弃

   接收方没有接受到数据帧，所以没有向发送方发送NAK。发送方因此陷入死锁。所以在发送完一个数据帧后，会立即启动一个定时器，如果超过重发时间$t_{out}$任收不到确认帧，就会重发刚刚发送的数据帧

3. 接收方发送的确认帧丢弃

   发送方接收不到接收方发送的确认帧，所以又发送了同一个数据帧。为了解绝相同帧的问题，在每次发送的数据帧前都加上标号加以区分

****

- $t_{P}=L/V$传播时延
- $t_{F}=F/C$发送时延
- $t_{A}=A/C$应答帧发送时延
- $t_{proc}$处理时延
- $t_D$发送时间

L：节点之间的距离

V：信号传播速率

F：数据帧的长度

A：应答帧的长度

C：数据发送速率

正常情况的信道利用率：

$\textcolor{green}{U=t_D/{t_F+t_A+2t_P+2t_{proc}}}$

忽略应答时间和处理时间。$t_{out}>=2t_P$

****

#### 3.滑动窗口协议

采用滑动窗口解决信道利用率低的问题

每发送完一个数据帧收，发送方不是等待确认帧，而是一边等待，一边继续发送若干数据帧

发送窗口：设置一个存储单元，用于保存已发送但尚未被确认的帧

接受窗口：一张接受序号列表及相应的缓冲区，所接受的帧序列号对应接受窗口中的序列号才可以接受，否则丢弃

:star:滑动窗口的工作方式：

1. 将发送窗口内所有的帧发送完毕
2. 根据接受窗口收到并确认的帧的个数，将发送窗口向右移动帧的个数的位置
3. 重复1的操作，直到序列全都发送完毕

滑动窗口控制方式：

ARQ：自动重发请求

- 连续ARQ

  发送完一个数据帧后，继续发送若干数据帧。$\textcolor{red}{如果出现差错，就从出现差错的数据帧开始全部重发}$

  ***实际应用中常常使用ACK1确认DATA0帧***

  ***发送窗口尺寸一般大于1，需要多位编码来表示已发但未被确认的帧序号***

  $\textcolor{red}{接受窗口尺寸等于1}$

  只有在发送窗口的大小$W_T<=2^{n}-1$时，连续ARQ协议才能正确运行

- 选择ARQ

  与连续ARQ基本类似。$\textcolor{red}{当出现差错，只重新发送出错的数据帧}$

  $\textcolor{red}{发送窗口尺寸最大值2^{n}/2}$

## 3.点对点信道的数据链路层协议

数据链路层协议又称位数据链路控制规程

根据协议处理的对象不同：

- 面向字符
  - 基本型
  - 高级
  - SLIP和PPP
- 面向比特
  - IBM制定SDLC
  - ISO制定HDLC
  - CCITT制定LAPB

****

透明传输：将传输内容由源地址传输到目的地址，不改变数据内容

****

### 1.HDLC

帧结构：

![帧的格式](https://gitee.com/qiqibaba43/image/raw/master/202303202022173.png)



1. 标志字段 F

   用于指明一个帧的开始与结束。由六个连续的1和首位两个0共八位组成。当连续发送多个帧的时候，可以同时作为结束标志和开始标志。当没有信息发送的时候，可以连续发送F，作为帧的填充，同时保持收发双方的同步

   <font color="red">当除标志字段外 出现连续5个1后，系统会在后面额外插入一个0。接受方，在收到连续5个1的时候，会自动将后面的0去除</font>

2. 地址字段 A

   不平衡配置：从站地址

   平衡配置：应答站地址

3. 控制字段 C

   根据控制字段分类：

   - 信息帧（I）

   - 监督帧（S）：监视和控制数据传送
   - 无编号帧（U）：数据链路的控制和管理，一场情况的处理和恢复

4. 信息字段 I

   在某些控制帧中，也会使用信息字段携带一些网络控制信息

5. 帧校验序列 FCS

   16位序列，使用循环冗余码检验地址字段，控制字段和信息字段

****

- 7~14个连续“1”表示一场终止，丢弃此帧
- 多于15个连续“1”表示：链路空闲，停止工作

****

### 2.点对点协议（PPP）

格式：

![ppp格式帧](https://gitee.com/qiqibaba43/image/raw/master/202303202023988.png)

## 4.多路访问信道的数据链路层

### 1.信道共享

- 静态共享
  - 频分复用
  - 时分复用
  - 码分复用
  - 波分复用
- 动态共享
  - 动态时分复用

### 2.竞争系统的截至访问控制

多个随机竞争的用户之间分配共享的单个公共信道，避免和解决可能出现的竞争冲突

- ALOHA

  随机发送

  - 纯ALOHA

    有数据要发送就直接传输，当有其他站在发送数据，就会引起冲突

  - 时隙ALOHA

    将信道按一帧的发送时间位单位划分成时隙，每一帧只能在时隙开始进行传送。减少了因两帧部分重叠引起的冲突

- CSMA

  先听后说原则，如果信道处于空闲状态就发送

  - 非坚持

    监听到信道空闲，立即发送。当监听到信道繁忙，不坚持监听，延时一个随机事件重新监听并准备

  - l-坚持

    在监听到信道繁忙后，一直监听直到信道空闲。当有两个及以上的站点在监听的时候就会发生冲突

  - P-坚持

    在监听到信道后，一直监听直到信道空闲。然后以p的概论直接发送，以1-p的概论延迟发送

### 3.环型网介质访问

各个站点和传输链路依次连接构成一个闭合的环

# 4.局域网与广域网

## 1.局域网基本概念

### 1.定义

将分散在一个局部地区地理返回的堕胎计算机通过传输媒体连接起来的通信网络，实现局部返回的资源共享与相互通信

特点：

- 覆盖范围小
- 高传输速率和低误码率
- 竞争访问，不考虑路由选择问题

### 2.技术特性

传输媒体：用于连接网络设备的介质类型

传输技术：借助传输媒体进行数据通信的技术

网络拓扑：物理结构和形状

介质访问控制方法：多个计算机对传输媒体的访问控制方法

## 2.以太网技术

IEEE802系列将局域网数据链路层分为两个部分：

- 逻辑控制子层（LLC）
- 媒体访问控制子层（MAC）

### 1.MAC层

每台主机都有一个唯一表示其地址的标识符。地址格式一般有静态分配和动态分配两种

1. 静态分配

   由网络硬件厂商在生产硬件时静态指定。通常占48位，前24位由IEEE分配，16位由厂商编号，其余位留作他用

2. 动态分配

   在安装网络时由系统管理员分配给上网设备。一般位16位

格式：

- 目的地址，源地址

  占6或2字节，可以是单播地址，组播地址或者广播地址

- 数据类型字段或数据长度字段、

  占2字节

- 用户数据字段

  长度小于等于1500字节

- 填充字段

  长度小于等于46字节，采用填充无符号字符的方法保证帧的长度不小于64字节

- 帧校验序列

  4字节的循环冗余码

<font color="red">发送一个MAC帧之前，会发送7字节的前导符和1字节的帧开始标识</font>

### 2.CSMA/CD

1. 载波监听
2. 多路访问
3. 冲突检测
4. 多次访问

:star:发生冲突时采用$\textcolor{red}{二进制指数退避算法}$：

遇到冲突时，随机选择一定范围内的退避等待时间片数

- 第一次冲突：0~1
- 第二次冲突：0~3
- 第$n$次冲突：0~$2^n-1$

争用期：传播时延影响，一个站点开始发送后的一段华健内，仍可能发生冲突。端到端往返时延称为争用期

争用期越大，信道利用率越低；最小帧长大于争用期

对于10mbit/s的局域网，实际取51.2us为争用期的长度，在争用期内可发送64字节。如果发送的数据长度不足64字节，则填充

## 3.局域网的扩展

### 1.集线器扩展

![集线器](https://gitee.com/qiqibaba43/image/raw/master/202303312040301.jpg)

集线器在双绞线以太网中用于链接网络工作站，并实现集中汇接。各个站点仍使用CSMA/CD访问基址，并$\textcolor{red}{共享}$逻辑上的总线。工作在物理层，利用再生放大功能实现远距离传送，利用级联实现网络规模和距离的扩展

物理结构：星型

逻辑结构：总线型

$\textcolor{red}{内部仍然是广播，共享应用方式}$

扩展原则：“5-4-3”

每段电缆的最大长度为500米，最多5段电缆，4个中继器，其中三段接入用户（避免用户数过多，冲突加剧）

<font color="red">集线器连接的局域网构成了一个更大的冲突域，最大吞吐量没有变</font>

优点：扩大地域范围，增加用户数

缺点：冲突加剧，CSMA/CD机制失效

### 2.网桥扩展

![网桥](https://gitee.com/qiqibaba43/image/raw/master/202303312040582.jpg)

网桥实现了端口之间的帧过滤和存储转发，实现了冲突域的划分，不受CSMA/CD争用期长度的限制

帧过滤：

- 目的MAC地址与源MAC地址在相同网段，丢弃
- 在不同两段，向目的地址所在特定端口转发
- 没有MAC地址，或MAC地址为广播地址，向其他所有端口广播

优点：过滤通信量，扩大物理范围，提高可靠性，互联不同物理层，MAC子层

缺点：需要先存储和查找转发表，然后才可以转发，增加了转发时延，没有流量控制，不同MAC子层之间相互转发，需要修改帧的某些内容，增加处理时延，用户数量不能太多

### 3.透明网桥

具有自学习功能：源站不在转发表中，将源站MAC地址加入到转发表

### 4.以太网交换机

工作三种方式：

- 存储转发方式

  将帧接收并缓存，进行帧校验，根据目的地址转发

- 直接方式

  接收到目的地址后立即发送

- 无碎片化直通方式

  当收到64帧以后才转发（避免残帧）

## 4.虚拟局域网

虚拟局域网（VLAN）在现有局域网上提供划分逻辑组的一种服务。每一个VLAN的帧都有一个$\textcolor{red}{标识符}$，指明工作站属于哪一个VLAN

![VLAN帧](https://gitee.com/qiqibaba43/image/raw/master/202303312041669.jpg)

VLAN划分两种方式：

- 静态VLAN
- 动态VLAN

## 5.无线局域网

无线局域网分为两大类。第一类是有固定基础设施的，第二类是无固定基础设施的

- 有固定基础设施的无线局域网

- 无固定基础设施的无线局域网

  由一些处于平等状态的移动站之间相互通信组成的临时网络。<font color='red'>移动站即时端系统，又可作为中继</font>

:star:无线局域网采用<font color='red'>CSMA/CA协议（载波监听多路访问/冲突避免）</font>

原因：

- 无线终端处理能力较弱
- 无线信号强度动态范围大，能量衰减大
- 存在<font color='red'>隐蔽站和暴露站的问题</font>

****

隐蔽站：两个站不知道对方的存在，向公共站点发送信息

暴露站：两个站向不同的站各自发送信息，但检测到对方正在发送信息

解决方法：

虚拟载波监听，让源站加ing需要占用信道的时间通知给其他站点，以便其他站点在这一段时间内停止发送数据

****

MAC层在物理层之上有两个子层：

- 分布协调功能DCF：争用信道获取发送权

- 带你协调功能PCF：发送数据权轮流交给各个站点

帧间间隔：所有站点发送完后，等待下一次发送的时间

帧间间隔的类型：

- SIFS：端帧间间隔
- PIFS：点协调功能
- DIFS：分布协调功能

:star:退避算法：

在信道忙转空，各个站点进入争用期，发生冲突后执行退避算法

$\textcolor{green}{第i次退避就在2^{i+2}个时隙种随机选一个}$

$\textcolor{red}{只有在信道空闲，且第一次发送数据帧，才不使用退避算法}$

## 6.广域网

广域网实现长距离传送，由$\textcolor{red}{节点交换机和链路构成}$

节点交换机采用存储转发方式

链路采用点到点链路

### 1.数据报服务

- 网络为每个分组独立选择路由
- 尽力将分组交付给目的主机，不保证顺序，不保证不丢失

### 2.虚电路服务

- 链接建立请求，找到一条合适的路由，然后发送信息

### 3.分组交换

广域网中分组转发寻址：

- 编址：层次结构的编址
- 路由：分组转发和路由机制

# 5.网络层与网络互联

## 1.网络层的概念

网络互连：网络层及以下

网络互联：高级部分（服务层，应用层）

![因特网分层模型](https://gitee.com/qiqibaba43/image/raw/master/202304061500603.png)

- Telnet
- FTP：文件传输协议
- SMTP：电子邮件传输协议
- DNS：域名解析
- SNMP
- ARP
- RARP

## 2.网络互连

因特网IP层的服务是一个尽最大努力传送，不可靠，无连接的数据包存储转发分组交换系统

### 1.IP地址

每个连接在因特网上的主机分配一个在全世界唯一的32bit的表示符

****

路由器是一种专门的计算机，实现网络互联，由多个IP地址

****

网络地址实际上是表示主机到网络的一个连接

IP采用分层的地址结构：网络号+主机号

### 2.IP地址的分类

![IP地址的分类](https://gitee.com/qiqibaba43/image/raw/master/202304071959952.png)

分类IP地址是自表示的，仅从地址本身就能确定前后缀之间的边界

| 网络类别 | 最大网络数 | 第一个可用网络号 | 最后一个网络号 | 最大主机数 |
| -------- | ---------- | ---------------- | -------------- | ---------- |
| A        | $2^7-2$    | 1                | 126            | 16777214   |
| B        | $2^{14}$   | 128.0            | 191.255        | 65534      |
| C        | $2^{21}$   | 192.0.0          | 233.255.255    | 254        |

| 特殊IP地址   | 含义             |
| ------------ | ---------------- |
| 网络号，0    | 指定的网络地址   |
| 网络号，<-1> | 定向广播地址     |
| <-1>，<-1>   | 有限广播地址     |
| 0，0         | 本主机           |
| 0，主机号    | 本网络上的某主机 |
| 127，<任意>  | 回送地址         |

### 3.映射

在实际物理网络的链路上传送数据帧的时候，必使用具体物理网络的硬件地址（网卡地址，交换机端口号）

- 在同一物理网络上

  1. 先在ARP高速缓存表中查找有无目的主机IP地址，有，则发送报文
  2. 没有对应MAC地址。形成ARP请求报文，<font color='red'>广播</font>报文
  3. 目的主机回应请求，<font color='red'>单播</font>返回ARP响应，同时记录源主机地址信息
  4. 源主机收到响应，记录地址信息，发送报文

- 不在同一物理网络上

  通过网关找到本LAN的硬件地址，将分组发送刚给它，路由器根据IP地址把分组转发给下一个网络

### 4.IP数据报

![IP数据报](https://gitee.com/qiqibaba43/image/raw/master/202304182148936.png)

- 版本：4比特，显示版本号
- 首部长度：最大长度是15*4字节，且必须是4的倍数
- 服务类型：8比特
- 总长度：16比特
- 标识：16比特，源主机中设置一个计数器，产生数据报的标识。当数据报分片的时候，相同标识表示分片属于同一个数据报
- 标志：3比特，只有低2位有效。第二位DF置1，表示数据报不能分片，0表示可以分片，第三位MF置1，表示不是最后一个分片，0表示是最后一个分片
- 片偏移量：13比特，表示相较于第一个数据报分片的偏移量
- 生存时间：8比特，数据包每经过一个路由器，TTL自动减1，当减为0的时候，路由器不在转发给=该数据包，而是丢弃
- 协议：8比特，
- 首部校验和：16比特
- 源站IP地址和目的站IP地址：32比特

### 5.无连接的数据报传送：

![经典路由结构](https://gitee.com/qiqibaba43/image/raw/master/202304201405509.png)



## 3.差错与控制报文协议ICMP

ICMP允许主机或路由器向$\textcolor{red}{源站}$报告差错情况和异常情况，还包括提供信息的功能

- 差错报告报文
  - 目的不可达报文
  - 超时报文
  - 源抑制报文
- 询问报文
  - 回应请求和应答报文
  - 时间戳请求额应答报文
  - 地址掩码请求和应答报文

## 4.子网编址及无分类编址与CIDR

### 1.子网编址

在IP地址中增加了“子网号字段”，使得多个物理网络可以公用一个网络前缀，这种做法叫“划分子网”

`IP结构：网络号+子网号+主机号`

主机号的最左边开始$\textcolor{red}{连续若干}$位作为子网号，位数可变

为了反应多少位用于子网号，使用32位网络掩码。<font color='red'>网络号，子网号为1，主机号为0</font>

子网号在网外不可见，只在子网内使用

<font color='red'>主机号全0或全1都不能分配给主机</font>

子网掩码的加入使得路由表表项：子网掩码，目的网络地址，下一跳地址

****

变长子网掩码（VLSM）：在划分子网的网络中同时使用不同的子网掩码

****

### 2.CIDR（无分类编址）

使用各种长度的网络前缀代替分类地址的网络号和子网号

`IP结构：网络号+主机号`

CIDR将网络前缀相同的连续的IP地址组成“CIDR地址块”

一个CIDR地址块可以表示多个地址，包括多个传统的C类网络地址，这种地址聚合称为路由聚合

使用CIDR，路由表的表项中由“网络前缀/掩码”和”下一跳“组成

### 3.专用IP

只在内部网络内使用的IP地址

![专用IP](https://gitee.com/qiqibaba43/image/raw/master/202304271504549.png)

## 5.路由选择协议

- 静态路由选择策略
- 动态路由选择策略

### 1.自治系统

互联网被分为许多较小的自治系统（AS）

单一技术干立下的一组路由器，使用一个内部网关西医和共同的测度确定如何在AS内路由分组

### 2.内部网关协议

#### 1.RIP（路由信息协议）

使用距离向量算法更新路由表。每一个路由器都维护自己到其他每一个目的网络的距离记录。RIP允许一条路径最多只能包含15个路由器。

路由器仅和相邻路由器交换信息，当网络拓扑发生变化的时候，路由器改变路由表

#### 2.OSPF（开放最短路径）

使用链路算法。每个路由器维护一个描述自治系统拓扑的数据库。

- 每个路由器向本自治系统中所有路由器发送信息（洪泛式）
- 只有当链路状态发生改变的时候，才使用洪泛法向所有路由器发送信息
- 发送的信息式路由器与其他相邻路由器之间链路状态

### 3.外部网关协议

BGP置寻找一条能够到达目的网络且比较好的路由

## 6.IP组播





## 7.专用网络





# 6.传输层

在通信子网提供服务的基础上，为上层应用层提供有效的合理的传输服务，使高层用户在相互通信时不必关心通信子网的实现细节和具体服务质量

## 1.传输服务

### 1.作用

- 两个主机进行通信实际上时两个主机中的应用进程相互通信
- 对整个报文段进行差错校验和检测
- 根据应用的不同，传输层需要执行不同的传输协议来提供不同的传输服务
- 使得传输服务比网络服务更加合理有效
- 采用一个原语集提供传输服务

## 2.传输层编址

传输层的UDP和TCP使用端口与上层的应用进程进行通信，端口就是传输策藏服务访问点TSAP

***端口就只有本地意义，是应用进程的标识，TCP和UDP各有65536个端口可以使用***

- 熟知端口：专门分配给一些最常用的应用层进程，数值为0~1023
- 一般端口：用来随时分配给请求通信的进程

端口号标识了高层应用进程，IP地址标识了网络中的一台主机。IP地址和端口号组合称为<font color='red'>套接字（Socket）</font>

![传输](https://gitee.com/qiqibaba43/image/raw/master/202305071517396.png)

五元组=<源IP地址，源端口，目的IP地址，目的端口，传输协议>

## 3.UDP协议

### 1.特点

- 无连接
- 不可靠
- 支持点到点和多点之间的通信
- 面向报文

### 2.检验

1. 首部校验和字段设置为0，如果UDP数据字段段长为奇数，则填充一个0字节
2. 按照16位为单位划分
3. 将UDP源端口，目的端口，长度，校验和，数据，源IP，目的IP求和，最高位产生的进位加到末尾
4. 对结果取反，就是UDP校验和

## 4.TCP协议

在传输层提供可靠的数据传输

### 1.特点

- 面向连接
- 提供可靠服务
- 点到点通信
- 面向字节流

### 2.报文格式

![TCP](https://gitee.com/qiqibaba43/image/raw/master/202305090846387.png)

- 序号：本报文段发送的数据的第一个字节的序号
- 确认号：期望收到的下一个报文段首部的序号字段的值
- 校验和：与UDP一样，不过伪首部协议字段值为6

### 3.连接管理

- 三次握手

  ![三次握手](https://gitee.com/qiqibaba43/image/raw/master/202305090906946.png)

  - 两次握手的问题

    当没有成功建立连接的时候，服务器会一直发送确认应答报文，咋总成资源浪费

  - 三次握手攻击原理

    使用僵尸主机向服务器发送海量变源IP请求，第三次握手不回复应答报文，服务器重试，等待一段时间，然后丢弃该请求

  - 使用随机值作为数据传输的开始序号

    防止没能正常四次挥手，导致历史报文被下一个相同的四元组的连接接受

- 四次挥手

  ![四次挥手](https://gitee.com/qiqibaba43/image/raw/master/202305090907148.png)

### 4.可靠传输

- 序号确定机制

  建立连接的时候，双方商定初始序号，TCP的是对接收到的数据的最高序号标识确认

- 超时重新机制

  往返时延无经典数值，方差大

  算平均往返时延，采用自适应算法，$\alpha$通常取$7/8$
  $$
  $RTT_{new}=RTT_{sample}   \\
  RTT_{new}=\alpha*RTT_{old}+(1-\alpha)*RTT_{sample}
  $$
  超时重传时间，$\beta$通常取$2$
  $$
  RTO=\beta*RTT
  $$

- 定时器设置

  设置多个定时器

  - 重传定时器
  - 持续定时器
  - 保活定时器

### 5.流量控制

<font color='red'>采用大小可变的滑动窗口</font>

发送窗口=Min[rwnd,cwnd]





# 7.应用层

应用层协议是<font color='red'>用户进程这几件</font>在通信时所要遵循的规定

![应用层协议](https://gitee.com/qiqibaba43/image/raw/master/202305161037826.png)

## 1.应用模式

- 以大型机为中心的应用模式

- 以服务器为中心的应用模式

  服务器提供公共的存储服务，客户端将数据下载下来，在本地处理数据，然后再上传到服务器

  缺点：对客户机的性能要求高

- 客户端/服务器应用模式

  客户机只需要提供简单的输入和显示，数据处理在服务器端完成

  缺点：维护困难，

- 基于Web的客户机/服务器的应用模式

  增加了网页中间件，使用标准的客户端软件，减少开发，维护的工作量

  缺点：当又大量用户访问时，造成阻塞。中间件使得效率降低

- P2P模式

  端系统主机既充当客户机，又充当服务器。避免专用服务器负荷过重，网络流量集中

## 2.工作模式

- 循环方式：在计算机中只运行一个服务器进程。当有多个客户进程请求服务时，按照请求的先后顺序依次响应
- 并发方式：在计算机中同时运行多个服务器进程，每一个服务器进程分别对某个特定的客户进程做出响应

服务器

- 无连接循环服务器

  同一时间只能向一个客户提供服务，从队列中读取下一个请求

  <font color='red'>熟知端口接收请求，每一个客户使用自己创建的临时端口</font>

- 面向连接并发服务器 

  同一时间向多个客户提供服务

  服务器包括<font color='red'>主服务器进程和从属服务器进程。祝福我i去进程在熟知端口等待请求，收到请求后，创建从属服务器，并指明临时端口提供服务。主服务器返回，在熟知端口等待其他客户请求</font>

### 1.域名系统（DNS）

- 因特网的域名系统DNS是一个分布式数据库联机系统

- 一般使用UDP传输
- 采用<font color='red'>层次树状结构</font>的命名方式

正向域名解析：

1. 递归解析：主机向根域名服务器发送请求，然后查询IP地址，并返回
2. 重复解析：先查看本地域名服务器中是否有带查找主机的IP地址，然后逐层向上查询

### 2.远程登录（Telnet）

远程登陆是因特网的基本应用服务之一，采用客户/服务器模式

网络虚拟终端（NVT）使用8位字符，最高位作为控制命令，其余为位ASCII码

### 3.文件传输协议（FTP）

面向连接的C/S服务模式，使用两条TCP连接完成文件传输，<font color='red'>一条连接用于控制（端口号21），另一条用于数据连接（端口号20）</font>

一个FTP服务器进程可以同时为多个客户进程提供服务

- 主进程：负责接收客户的请求
- 从属进程：负责处理请求，按需可由多个从属进程

主进程与从属进程之间是并发关系

<font color='red'>虽然用的是熟知端口，但五元组不一样，所以不会发生混淆</font>

<font color='red'>FTP提供交互式的访问</font>，允许客户执行文件类型与格式

### 4.简单文本传输协议（TFTP）

使用C/S模式，采用<font color='red'>UDP</font>数据报，因此需要TFTP由差错改正措施，流量控制

使用<font color='red'>熟知端口69</font>，只支持文件传输，不支持<font color='red'>交互</font>

特点：

- 每次传送的数据PDU有512字节，最后一次可以不足512字节
- 数据PDU称为文件块，按序编号，从1开始
- 支持ASCII码或二进制
- 可对文件进行读写
- 使用简单的首部、

:star:文件不是512字节的整数倍，最后一次不足512字节作为文件结束标志；文件时512字节整数倍，在文件传输完毕后，还要发送一个只有首部，没有数据的PDU

### 5.引导程序协议与动态主机配置协议

- 引导程序协议（BOOTP）

  全1为目的地址，全0为源地址，收到报文请求后，返回各项配置信息（IP地址，子网掩码，默认路由器IP地址，域名服务器IP地址）

- 动态主机配置协议（DHCP）

  先查找是否有该计算机的配置信息，有则返回；没有就从<font color='red'>服务器的IP地址池中任选一个IP地址分配</font>

## 3.电子邮件系统与SMTP

- SMTP只能传输7位ASCII码邮件
- 邮件扩展MIME可以传输多种类型的数据

发送过程：

![电子邮件的发送](https://gitee.com/qiqibaba43/image/raw/master/202305182100676.png)







![MIME与SMMTP关系](https://gitee.com/qiqibaba43/image/raw/master/202305210805373.jpg)







## 4.万维网与HTTP

万维网WWW用<font color='red'>链接</font>的方式从因特网上的一个站点访问另一个站点

万维网是分布式超媒体系统，是超文本系统的扩充
